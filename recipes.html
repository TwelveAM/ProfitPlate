<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ProfitPlate – Recipes</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta
      name="description"
      content="See recipe costs per portion and margins for your menu."
    />
    <link rel="stylesheet" href="assets/styles.css" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/favicon-plate-32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="64x64"
      href="assets/favicon-plate-64.png"
    />
  </head>
  <body>
    <div class="page">
      <!-- Header with nav -->
      <header class="header">
        <div class="logo-block">
          <div class="logo-plate">
            <span>PP</span>
          </div>
          <div class="brand-text">
            <div class="name">ProfitPlate</div>
            <div class="tagline">Know your profit per plate.</div>
          </div>
        </div>

        <nav class="nav">
          <a href="index.html" class="nav-link">Home</a>
          <a href="purchases.html" class="nav-link">Purchases</a>
          <a href="recipes.html" class="nav-link nav-link-active">Recipes</a>
        </nav>
      </header>

      <main>
        <!-- Hero -->
        <section class="hero">
          <h1 class="hero-title">Recipes</h1>
          <p class="hero-subtitle">
            See cost per portion and profit margin for each dish on your menu.
            Adjust selling price and keep an eye on how ingredient changes
            affect your bottom line.
          </p>
        </section>

        <!-- Top actions -->
        <section class="hero-actions" style="margin-bottom: 18px;">
          <button class="btn-primary" type="button">
            Add recipe (prototype)
          </button>
          <button class="btn-secondary" type="button">
            Export all to PDF (future)
          </button>
        </section>
<!-- Dynamic Recipe List -->
<section class="recipe-list" id="recipe-list">
  <div
    style="
      font-size: 13px;
      margin-bottom: 6px;
      color: #555;
      font-weight: 600;
    "
  >
    Menu overview
  </div>

  <div id="recipes-container">
    <!-- JS will insert recipes here -->
  </div>
</section>

<!-- Recipe Detail Prototype (hidden initially) -->
<section class="recipe-card" id="recipe-detail" style="display: none;">
  <div class="recipe-card-title" id="detail-name"></div>
  <div class="recipe-card-subtitle">
    Cost automatically updates if ingredient prices change in Purchases.
  </div>

  <div class="recipe-summary" id="summary-box">
    <!-- JS will fill batch size, cost, margin -->
  </div>

  <div
    style="
      overflow-x: auto;
      border-radius: 10px;
      border: 1px solid #e0e3ea;
      background: #f9fafb;
    "
  >
    <table
      style="
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      "
    >
      <thead>
        <tr
          style="
            text-align: left;
            background: #f4f5f9;
            border-bottom: 1px solid #e0e3ea;
          "
        >
          <th style="padding: 8px 10px;">Ingredient</th>
          <th style="padding: 8px 10px;">Category</th>
          <th style="padding: 8px 10px;">Sub-type</th>
          <th style="padding: 8px 10px;">Quantity</th>
          <th style="padding: 8px 10px;">Unit</th>
          <th style="padding: 8px 10px;">Price/unit</th>
          <th style="padding: 8px 10px;">Cost in recipe</th>
        </tr>
      </thead>
      <tbody id="detail-ingredients">
        <!-- JS inserts rows -->
      </tbody>
    </table>
  </div>
</section>

      </main>

      <div class="bottom-strip" style="margin-top: 22px;">
        This page is a static prototype of the Recipes view. Next steps: make
        recipes editable, connect them to real ingredients, and allow exporting
        PDFs for the boss.
      </div>
    </div>
    <script src="assets/app.js"></script>
    <script>
  const container = document.getElementById("recipes-container");
  const detailCard = document.getElementById("recipe-detail");
  const detailName = document.getElementById("detail-name");
  const detailIngredients = document.getElementById("detail-ingredients");
  const summaryBox = document.getElementById("summary-box");

  function renderRecipes() {
    container.innerHTML = "";

    if (!ppData.recipes.length) {
      container.innerHTML = `<p style="color:#666;">No recipes yet.</p>`;
      return;
    }

    ppData.recipes.forEach((recipe) => {
      const costPerPortion = calculateCostPerPortion(recipe).toFixed(2);
      const row = document.createElement("div");
      row.className = "recipe-row";

      row.innerHTML = `
        <div>
          <div class="recipe-name">${recipe.name}</div>
          <div class="recipe-meta">
            ${recipe.portions} portions per batch
          </div>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
          <span class="recipe-cost-badge">${costPerPortion} €/portion</span>
          <button class="btn-secondary" type="button"
            onclick="openRecipeDetail('${recipe.id}')">
            View details
          </button>
        </div>
      `;

      container.appendChild(row);
    });
  }

  function openRecipeDetail(id) {
    const r = getRecipeById(id);
    if (!r) return;

    detailCard.style.display = "block";
    detailName.textContent = r.name;

    // Summary
    const batchCost = calculateBatchCost(r).toFixed(2);
    const cpp = calculateCostPerPortion(r).toFixed(2);

    summaryBox.innerHTML = `
      <span><strong>Batch size:</strong> ${r.portions} portions</span>
      <span><strong>Total batch cost:</strong> ${batchCost} €</span>
      <span><strong>Cost per portion:</strong> ${cpp} €</span>
    `;

    // Ingredients table
    detailIngredients.innerHTML = "";

    r.ingredients.forEach((ing) => {
      const purchase = getPurchaseById(ing.purchaseId);
      if (!purchase) return;

      const cost = calculateIngredientCost(ing).toFixed(2);

      const row = document.createElement("tr");
      row.innerHTML = `
        <td style="padding:7px 10px;">${purchase.name}</td>
        <td style="padding:7px 10px;">${purchase.category}</td>
        <td style="padding:7px 10px;">${purchase.subtype}</td>
        <td style="padding:7px 10px;">${ing.quantity}</td>
        <td style="padding:7px 10px;">${ing.unit}</td>
        <td style="padding:7px 10px;">${purchase.pricePerUnit} €/unit</td>
        <td style="padding:7px 10px;">${cost} €</td>
      `;
      detailIngredients.appendChild(row);
    });
  }

  // Load on page open
  renderRecipes();
</script>
  </body>
</html>
