<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Purchases – ProfitPlate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Manage your ingredient base for ProfitPlate – purchases, categories, prices, suppliers and invoices."
  />
  <link rel="stylesheet" href="assets/styles.css" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-plate-32.png" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background-color: #f5f5f5;
      color: #222222;
    }
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 20px 40px;
    }
  </style>
</head>

<body>
  <!-- Shared header -->
  <div id="site-header"></div>

  <div class="page">
    <h1>Purchases</h1>
    <p style="font-size:14px;color:#555;max-width:720px;">
      This is your ingredient base. Add items you buy, organize them by category, and keep supplier prices
      up to date. Recipes will use everything you add here.
    </p>

    <div style="margin-top:20px;margin-bottom:10px;">
      <button type="button" class="btn-primary" onclick="toggleAddForm()">Add item manually</button>
    </div>

    <!-- Add / edit purchase form -->
    <div id="add-item-form" class="hidden" style="margin-top:10px;">
      <div class="settings-box">
        <h2 class="section-title">Add a new purchase item</h2>

        <form id="purchase-form">
          <div class="settings-field">
            <label for="item-name" class="settings-label">Name</label>
            <input id="item-name" type="text" placeholder="e.g. Butter 82% 1kg" />
          </div>

          <div class="settings-field" style="display:flex;gap:12px;flex-wrap:wrap;">
            <div style="flex:1;min-width:160px;">
              <label for="item-category" class="settings-label">Category</label>
              <select id="item-category" class="settings-select">
                <option value="">Select...</option>
                <option value="Meat &amp; Fish">Meat &amp; Fish</option>
                <option value="Dairy & Eggs">Dairy &amp; Eggs</option>
                <option value="Vegetables & Fruit">Vegetables &amp; Fruit</option>
                <option value="Dry Goods">Dry Goods</option>
                <option value="Spices & Condiments">Spices &amp; Condiments</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div style="flex:1;min-width:160px;">
              <label for="item-subtype" class="settings-label">Sub-type</label>
              <select id="item-subtype" class="settings-select">
                <option value="">Select...</option>
              </select>
            </div>
          </div>

          <div class="settings-field">
            <label for="item-supplier" class="settings-label">Supplier</label>
            <input id="item-supplier" type="text" placeholder="e.g. Metro, local butcher..." />
          </div>

          <div class="settings-field" style="display:flex;gap:12px;flex-wrap:wrap;">
            <div style="flex:1;min-width:160px;">
              <label for="item-invoice-number" class="settings-label">Invoice number</label>
              <input
                id="item-invoice-number"
                type="text"
                placeholder="e.g. 2025-0456 or Ticket #32"
              />
            </div>

            <div style="flex:1;min-width:160px;">
              <label for="item-invoice-date" class="settings-label">Invoice date</label>
              <input id="item-invoice-date" type="date" />
            </div>
          </div>

          <div class="settings-field" style="display:flex;gap:12px;flex-wrap:wrap;">
            <div style="flex:1;min-width:160px;">
              <label for="item-unit" class="settings-label">Unit (for recipes)</label>
              <select id="item-unit" class="settings-select">
                <option value="">Select...</option>
                <option value="kg">kg</option>
                <option value="g">gr</option>
                <option value="L">L</option>
                <option value="ml">ml</option>
                <option value="pcs">pcs</option>
              </select>
            </div>

            <div style="flex:1;min-width:160px;">
              <label for="item-price" class="settings-label">Purchase price (per recipe unit)</label>
              <input
                id="item-price"
                type="number"
                step="0.0001"
                placeholder="e.g. 16.00"
              />
            </div>
          </div>

          <hr style="margin:16px 0;" />

          <h3 style="margin:0 0 4px;font-size:15px;">Or use pack helper</h3>
          <p class="settings-help" style="margin-top:2px;">
            Example: 100 gr for 5 € → auto-converts price per unit.
          </p>

          <div class="settings-field" style="display:flex;gap:12px;flex-wrap:wrap;margin-top:10px;">
            <div style="flex:1;min-width:120px;">
              <label for="pack-qty" class="settings-label">Pack quantity</label>
              <input id="pack-qty" type="number" step="0.01" placeholder="e.g. 100" />
            </div>

            <div style="flex:1;min-width:120px;">
              <label for="pack-unit" class="settings-label">Pack unit</label>
              <select id="pack-unit" class="settings-select">
                <option value="">unit</option>
                <option value="g">gr</option>
                <option value="kg">kg</option>
                <option value="ml">ml</option>
                <option value="L">L</option>
                <option value="pcs">pcs</option>
              </select>
            </div>

            <div style="flex:1;min-width:120px;">
              <label for="pack-price" class="settings-label">Pack price (€)</label>
              <input id="pack-price" type="number" step="0.01" placeholder="e.g. 5.00" />
            </div>

            <div style="display:flex;align-items:flex-end;">
              <button
                type="button"
                class="btn-secondary"
                style="margin-top:22px;"
                onclick="fillPriceFromPack()"
              >
                Use pack
              </button>
            </div>
          </div>

          <div class="settings-field">
            <label for="item-notes" class="settings-label">Notes (storage, etc.)</label>
            <textarea
              id="item-notes"
              rows="2"
              placeholder="Remarks, storage notes..."
            ></textarea>
          </div>

          <!-- Price history block -->
          <div
            id="price-history-block"
            class="settings-box hidden"
            style="margin-top:16px;background:#fafafa;border:1px dashed #ddd;"
          >
            <h3 class="section-title" style="font-size:15px;margin-bottom:8px;">Price history</h3>
            <p class="settings-help" style="margin-top:0;margin-bottom:8px;">
              Last 10 recorded price changes for this ingredient (newest first).
            </p>
            <div style="overflow-x:auto;">
              <table class="table" style="font-size:13px;">
                <thead>
                  <tr>
                    <th style="width:40%;">Date</th>
                    <th>Price / unit</th>
                  </tr>
                </thead>
                <tbody id="price-history-body"></tbody>
              </table>
            </div>
          </div>

          <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:18px;">
            <button type="button" class="btn-secondary" onclick="toggleAddForm()">Cancel</button>
            <button type="submit" class="btn-primary">Save item</button>
          </div>
        </form>
      </div>
    </div>

    <hr style="margin:24px 0 16px;" />

    <!-- Recently updated -->
    <h2>Recently updated</h2>
    <div id="recent-list" style="margin-top:10px;">
      <!-- Filled by app.js -->
    </div>

    <hr style="margin:24px 0 16px;" />

    <!-- All ingredients -->
    <div
      style="
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:12px;
        margin-bottom:8px;
      "
    >
      <h2 style="margin:0;">All ingredients</h2>
      <input
        id="search-input"
        type="text"
        placeholder="Search by name, category, supplier, invoice..."
        style="max-width:260px;"
      />
    </div>

    <!-- Category filter -->
    <div class="settings-field" style="max-width:260px;margin-top:6px;">
      <label for="category-filter" class="settings-label">Category filter</label>
      <select id="category-filter" class="settings-select">
        <option value="">All categories</option>
        <option value="Meat &amp; Fish">Meat &amp; Fish</option>
        <option value="Dairy & Eggs">Dairy &amp; Eggs</option>
        <option value="Vegetables & Fruit">Vegetables &amp; Fruit</option>
        <option value="Dry Goods">Dry Goods</option>
        <option value="Spices & Condiments">Spices &amp; Condiments</option>
        <option value="Other">Other</option>
      </select>
    </div>

    <div style="overflow-x:auto;margin-top:8px;">
      <table class="table">
        <thead>
          <tr>
            <th>Ingredient</th>
            <th>Category</th>
            <th>Sub-type</th>
            <th>Supplier</th>
            <th>Invoice #</th>
            <th>Unit</th>
            <th>Latest price</th>
            <th>Last updated</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="purchase-table"></tbody>
      </table>
    </div>
  </div>

  <script src="assets/header.js"></script>
  <script>
    renderHeader('purchases');
  </script>
  <script src="assets/app.js"></script>
</body>
</html>
